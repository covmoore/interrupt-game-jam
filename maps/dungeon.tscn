[gd_scene load_steps=34 format=3 uid="uid://bcrnhkm7n7ejm"]

[ext_resource type="PackedScene" uid="uid://clfr6g1wxrggi" path="res://prefabs/player.tscn" id="1_bbrec"]
[ext_resource type="Script" path="res://scripts/managers/gameManager.gd" id="1_mva7x"]
[ext_resource type="Script" path="res://scripts/handlers/camera_pan.gd" id="2_8fhd0"]
[ext_resource type="Shader" path="res://shaders/cyberground.gdshader" id="2_hfbtt"]
[ext_resource type="Script" path="res://maps/room_manager.gd" id="4_7eefm"]
[ext_resource type="Shader" path="res://shaders/cyber_dungeon.gdshader" id="5_xgppb"]
[ext_resource type="PackedScene" uid="uid://mafc2j10hbtt" path="res://prefabs/enemy.tscn" id="6_rpdv3"]
[ext_resource type="PackedScene" uid="uid://bx318d6ukm8n2" path="res://scripts/ui/player_ui.tscn" id="9_3ai7s"]
[ext_resource type="Script" path="res://scripts/handlers/pivot_anchor_handler.gd" id="9_g68le"]
[ext_resource type="Script" path="res://maps/enemy_spawner.gd" id="10_de85t"]
[ext_resource type="Script" path="res://scripts/models/wave.gd" id="11_xxg05"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ugbub"]
shader = ExtResource("5_xgppb")
shader_parameter/horizon_color = Color(0.3, 0.2, 0.2, 1)
shader_parameter/zenith_color = Color(0.5, 0.2, 0.4, 1)
shader_parameter/intensity = 1.0

[sub_resource type="Sky" id="Sky_ut1ug"]
sky_material = SubResource("ShaderMaterial_ugbub")

[sub_resource type="Environment" id="Environment_g5vgi"]
background_color = Color(0.0177324, 0.0177324, 0.0177324, 1)
sky = SubResource("Sky_ut1ug")
glow_intensity = 1.02
glow_bloom = 0.18
fog_mode = 1
fog_density = 1.0

[sub_resource type="NavigationMesh" id="NavigationMesh_hpwqc"]
vertices = PackedVector3Array(3.25, 0.5, -1.75, 4.5, 0.5, -1.5, 4.75, 0.5, -2, 3, 0.5, -2.75, 6, 0.5, -2, 6.25, 0.5, -0.75, 7, 0.5, -0.75, 7, 0.5, -7, -2.75, 0.5, -2.75, -7, 0.5, -7, -7, 0.5, -1.75, -3, 0.5, -1.75, -0.5, 0.5, 7, -0.25, 0.5, 6, -1.75, 0.5, 6, -7, 0.5, 7, -2.75, 0.5, -1, -2, 0.5, 4.5, -0.25, 0.5, 4.25, -0.5, 0.5, -1, 2.75, 0.5, -1, 4.75, 0.5, 2.25, 2, 0.5, 6, 7, 0.5, 7, 6.25, 0.5, 2, 2.25, 0.5, 4.5)
polygons = [PackedInt32Array(1, 0, 2), PackedInt32Array(2, 0, 3), PackedInt32Array(5, 4, 6), PackedInt32Array(6, 4, 7), PackedInt32Array(3, 8, 7), PackedInt32Array(7, 8, 9), PackedInt32Array(2, 3, 4), PackedInt32Array(4, 3, 7), PackedInt32Array(11, 10, 8), PackedInt32Array(8, 10, 9), PackedInt32Array(13, 12, 14), PackedInt32Array(14, 12, 15), PackedInt32Array(11, 16, 10), PackedInt32Array(10, 16, 17), PackedInt32Array(10, 17, 15), PackedInt32Array(18, 17, 19), PackedInt32Array(19, 17, 16), PackedInt32Array(17, 14, 15), PackedInt32Array(0, 1, 20), PackedInt32Array(20, 1, 21), PackedInt32Array(13, 22, 12), PackedInt32Array(12, 22, 23), PackedInt32Array(5, 6, 24), PackedInt32Array(24, 6, 23), PackedInt32Array(25, 21, 22), PackedInt32Array(22, 21, 24), PackedInt32Array(22, 24, 23), PackedInt32Array(25, 18, 21), PackedInt32Array(21, 18, 20), PackedInt32Array(20, 18, 19)]
detail_sample_distance = 8.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_phwww"]
render_priority = 0
shader = ExtResource("2_hfbtt")
shader_parameter/grid_color = Color(0, 1, 1, 1)
shader_parameter/line_thickness = 0.02
shader_parameter/glow_intensity = 1.0

[sub_resource type="PlaneMesh" id="PlaneMesh_7qubq"]
material = SubResource("ShaderMaterial_phwww")
size = Vector2(15, 15)

[sub_resource type="BoxShape3D" id="BoxShape3D_vkvcm"]
size = Vector3(15, 0.01, 15)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_j64jk"]
albedo_color = Color(1, 0.141176, 1, 1)

[sub_resource type="Resource" id="Resource_kdfmp"]
script = ExtResource("11_xxg05")
wave_number = 1
spawn_rate = 1.0
enemies = Array[PackedScene]([ExtResource("6_rpdv3"), ExtResource("6_rpdv3")])

[sub_resource type="Resource" id="Resource_fkvqh"]
script = ExtResource("11_xxg05")
wave_number = 2
spawn_rate = 1.0
enemies = Array[PackedScene]([ExtResource("6_rpdv3"), ExtResource("6_rpdv3"), ExtResource("6_rpdv3")])

[sub_resource type="Resource" id="Resource_otk37"]
script = ExtResource("11_xxg05")
wave_number = 3
spawn_rate = 1.0
enemies = Array[PackedScene]([ExtResource("6_rpdv3")])

[sub_resource type="BoxMesh" id="BoxMesh_4skxw"]
size = Vector3(1.5, 1.7, 0.325)

[sub_resource type="BoxShape3D" id="BoxShape3D_5rkse"]
size = Vector3(1.5, 1.7, 0.325)

[sub_resource type="PlaneMesh" id="PlaneMesh_qklci"]
size = Vector2(15, 5)

[sub_resource type="BoxShape3D" id="BoxShape3D_a082y"]
size = Vector3(14.9377, 0.01, 4.99658)

[sub_resource type="PlaneMesh" id="PlaneMesh_7boyc"]
size = Vector2(15, 5)

[sub_resource type="BoxShape3D" id="BoxShape3D_7a4r0"]
size = Vector3(14.9895, 0.01, 4.95514)

[sub_resource type="PlaneMesh" id="PlaneMesh_qugxo"]
size = Vector2(15, 5)

[sub_resource type="BoxShape3D" id="BoxShape3D_1gnro"]
size = Vector3(14.9694, 0.01, 4.95288)

[sub_resource type="PlaneMesh" id="PlaneMesh_woah8"]
size = Vector2(15, 5)

[sub_resource type="BoxShape3D" id="BoxShape3D_fxypm"]
size = Vector3(6.17316, 0.01, 4.94733)

[sub_resource type="BoxShape3D" id="BoxShape3D_gh8lk"]
size = Vector3(7.29797, 0.01, 4.87164)

[node name="Dungeon1" type="Node3D" node_paths=PackedStringArray("main_room", "player", "camera", "camera_pivot", "uiManager", "rooms", "pivot_anchors")]
script = ExtResource("1_mva7x")
main_room = NodePath("start_room")
player = NodePath("Player")
camera = NodePath("CameraPivot/Camera3D")
camera_pivot = NodePath("CameraPivot")
uiManager = NodePath("PlayerUI")
rooms = [NodePath("start_room")]
pivot_anchors = [NodePath("pivot_anchors/start_pivot")]

[node name="Player" parent="." node_paths=PackedStringArray("player_ui") instance=ExtResource("1_bbrec")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.69177, 0)
collision_mask = 30
speed = 5
player_ui = NodePath("../PlayerUI")

[node name="CameraPivot" type="Node3D" parent="."]

[node name="Camera3D" type="Camera3D" parent="CameraPivot" node_paths=PackedStringArray("camera_pivot", "player", "mainCameraAnchor", "gameManager")]
transform = Transform3D(1, 0, 0, 0, 0.393204, 0.919451, 0, -0.919451, 0.393204, 0, 9.43599, 5.07966)
script = ExtResource("2_8fhd0")
camera_pivot = NodePath("..")
player = NodePath("../../Player")
mainCameraAnchor = NodePath("../mainCameraAnchor")
gameManager = NodePath("../..")

[node name="mainCameraAnchor" type="Node3D" parent="CameraPivot"]
transform = Transform3D(1, 0, 0, 0, 0.393204, 0.919451, 0, -0.919451, 0.393204, 0, 9.43599, 5.07966)

[node name="start_room" type="Node3D" parent="." node_paths=PackedStringArray("player", "doors", "enemySpawners")]
script = ExtResource("4_7eefm")
player = NodePath("../Player")
number_of_waves = 3
doors = [NodePath("door")]
enemySpawners = [NodePath("EnemySpawnZones/Zone1"), NodePath("EnemySpawnZones/Zone2")]

[node name="WorldEnvironment" type="WorldEnvironment" parent="start_room"]
environment = SubResource("Environment_g5vgi")

[node name="Navmesh" type="NavigationRegion3D" parent="start_room"]
navigation_mesh = SubResource("NavigationMesh_hpwqc")

[node name="Ground" type="StaticBody3D" parent="start_room/Navmesh" groups=["Ground"]]
collision_mask = 7

[node name="MeshInstance3D" type="MeshInstance3D" parent="start_room/Navmesh/Ground"]
mesh = SubResource("PlaneMesh_7qubq")

[node name="CollisionShape3D" type="CollisionShape3D" parent="start_room/Navmesh/Ground"]
shape = SubResource("BoxShape3D_vkvcm")

[node name="obstacles" type="Node3D" parent="start_room/Navmesh"]

[node name="obstacle" type="CSGBox3D" parent="start_room/Navmesh/obstacles"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.55, -2)
use_collision = true
collision_layer = 2
size = Vector3(5, 1, 0.5)
material = SubResource("StandardMaterial3D_j64jk")

[node name="obstacle2" type="CSGBox3D" parent="start_room/Navmesh/obstacles"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.55, 5.10623)
use_collision = true
collision_layer = 2
size = Vector3(3, 1, 0.5)
material = SubResource("StandardMaterial3D_j64jk")

[node name="obstacle3" type="CSGBox3D" parent="start_room/Navmesh/obstacles"]
transform = Transform3D(-4.37114e-08, 0, 1, 0, 1, 0, -1, 0, -4.37114e-08, 5.47882, 0.55, 0)
use_collision = true
collision_layer = 2
size = Vector3(3, 1, 0.5)
material = SubResource("StandardMaterial3D_j64jk")

[node name="EnemySpawnZones" type="Node3D" parent="start_room"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.55, 0)

[node name="Zone1" type="Marker3D" parent="start_room/EnemySpawnZones"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 6, 0, 5.4)
script = ExtResource("10_de85t")
rounds = Array[ExtResource("11_xxg05")]([SubResource("Resource_kdfmp"), SubResource("Resource_fkvqh")])

[node name="Zone2" type="Marker3D" parent="start_room/EnemySpawnZones"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.69587, 0, -5)
script = ExtResource("10_de85t")
rounds = Array[ExtResource("11_xxg05")]([SubResource("Resource_otk37")])

[node name="Zone3" type="Marker3D" parent="start_room/EnemySpawnZones"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -4.696, 0, 5)
script = ExtResource("10_de85t")
rounds = Array[ExtResource("11_xxg05")]([SubResource("Resource_otk37")])

[node name="Zone4" type="Marker3D" parent="start_room/EnemySpawnZones"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 0, -5)
script = ExtResource("10_de85t")
rounds = Array[ExtResource("11_xxg05")]([SubResource("Resource_otk37")])

[node name="Zone5" type="Marker3D" parent="start_room/EnemySpawnZones"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5, 0, 0)
script = ExtResource("10_de85t")
rounds = Array[ExtResource("11_xxg05")]([SubResource("Resource_otk37")])

[node name="door" type="StaticBody3D" parent="start_room"]
transform = Transform3D(-4.37114e-08, 0, -1, 0, 1, 0, 1, 0, -4.37114e-08, 7.437, 0.852693, -0.51818)
collision_layer = 2

[node name="MeshInstance3D" type="MeshInstance3D" parent="start_room/door"]
mesh = SubResource("BoxMesh_4skxw")

[node name="CollisionShape3D" type="CollisionShape3D" parent="start_room/door"]
shape = SubResource("BoxShape3D_5rkse")

[node name="Walls" type="Node3D" parent="start_room"]

[node name="Wall1" type="StaticBody3D" parent="start_room/Walls" groups=["Wall"]]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 2.43923, 7.4822)
collision_layer = 2
collision_mask = 29

[node name="MeshInstance3D" type="MeshInstance3D" parent="start_room/Walls/Wall1"]
mesh = SubResource("PlaneMesh_qklci")

[node name="CollisionShape3D" type="CollisionShape3D" parent="start_room/Walls/Wall1"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00427246, 0, 0.0192871)
shape = SubResource("BoxShape3D_a082y")

[node name="Wall2" type="StaticBody3D" parent="start_room/Walls" groups=["Wall"]]
transform = Transform3D(-1, 8.74228e-08, 3.82137e-15, 0, -4.37114e-08, 1, 8.74228e-08, 1, 4.37114e-08, 0, 2.43923, -7.46049)
collision_layer = 2
collision_mask = 29

[node name="MeshInstance3D" type="MeshInstance3D" parent="start_room/Walls/Wall2"]
mesh = SubResource("PlaneMesh_7boyc")

[node name="CollisionShape3D" type="CollisionShape3D" parent="start_room/Walls/Wall2"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0245361, 0, 0.0186462)
shape = SubResource("BoxShape3D_7a4r0")

[node name="Wall3" type="StaticBody3D" parent="start_room/Walls" groups=["Wall"]]
transform = Transform3D(1.31134e-07, 1, 4.37114e-08, 0, -4.37114e-08, 1, 1, -1.31134e-07, -5.73206e-15, -7.51138, 2.43923, -0.00124407)
collision_layer = 2
collision_mask = 29

[node name="MeshInstance3D" type="MeshInstance3D" parent="start_room/Walls/Wall3"]
mesh = SubResource("PlaneMesh_qugxo")

[node name="CollisionShape3D" type="CollisionShape3D" parent="start_room/Walls/Wall3"]
transform = Transform3D(1, 0, 0, 0, 1, 7.51668e-22, 0, 7.51667e-22, 1, 0.0501099, 0, 0.0313721)
shape = SubResource("BoxShape3D_1gnro")

[node name="Wall4" type="StaticBody3D" parent="start_room/Walls" groups=["Wall"]]
transform = Transform3D(-2.18557e-07, -1, -4.37114e-08, 0, -4.37114e-08, 1, -1, 2.18557e-07, 9.55343e-15, 7.45403, 2.43923, -0.00124407)
collision_layer = 2
collision_mask = 29

[node name="MeshInstance3D" type="MeshInstance3D" parent="start_room/Walls/Wall4"]
mesh = SubResource("PlaneMesh_woah8")

[node name="CollisionShape3D" type="CollisionShape3D" parent="start_room/Walls/Wall4"]
transform = Transform3D(1, 0, 0, 0, 1, 2.08797e-21, 0, 2.08797e-21, 1, 4.3779, 0, 0.0176697)
shape = SubResource("BoxShape3D_fxypm")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="start_room/Walls/Wall4"]
transform = Transform3D(1, 0, 0, 0, 1, 2.08797e-21, 0, 2.08797e-21, 1, -3.87686, 9.53674e-07, -0.0294495)
shape = SubResource("BoxShape3D_gh8lk")

[node name="OmniLight3D" type="OmniLight3D" parent="start_room"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 8.3596, 0)
light_energy = 10.799
omni_range = 20.0

[node name="pivot_anchors" type="Node3D" parent="."]

[node name="start_pivot" type="Node3D" parent="pivot_anchors"]
script = ExtResource("9_g68le")
room = "start_room"

[node name="PlayerUI" parent="." node_paths=PackedStringArray("cam", "gameManager") instance=ExtResource("9_3ai7s")]
cam = NodePath("../CameraPivot/Camera3D")
gameManager = NodePath("..")
